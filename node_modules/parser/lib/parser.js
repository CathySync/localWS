var fs = require('fs');
var path = require('path');
var csv = require("csv");

var parser = module.exports = function parser(options){
    this.type = options.type;
    this.delimiter = options.delimiter;
    this.comment = options.comment;
    this.location = options.location;
};

parser.prototype.getDelimiter = getDelimiter;
parser.prototype.getComment = getComment;
parser.prototype.parse = parse;

function parse(){
    var fstream = fs.createReadStream(this.location);
    var encoding = fstream.defaultEncoding;
    if(!encoding) encoding = "utf8";
    fstream.setEncoding(encoding);
    
    fstream.pipe(csv.transform(function(record){
           return record.map(function(value){
             return value + "|"
           });
        }))
        .pipe(csv.stringify())
        .pipe(process.stdout);
    
}

function getDelimiter(){
    return this.delimiter;
};

function getComment(){
    return this.comment;
}
